<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Yakutia Market</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Round" rel="stylesheet">
    <style>
        :root { --p: #00639b; --bg: #f8fdff; }
        body { font-family: 'Roboto', sans-serif; margin: 0; background: var(--bg); padding-bottom: 80px; }
        .app-bar { position: sticky; top: 0; background: rgba(255,255,255,0.95); padding: 10px 16px; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 1px 3px rgba(0,0,0,0.1); z-index: 100; }
        .brand { font-size: 20px; font-weight: bold; color: var(--p); display: flex; align-items: center; gap: 5px; cursor: pointer; }
        .btn { border: none; background: var(--p); color: white; padding: 8px 16px; border-radius: 20px; font-weight: 500; cursor: pointer; }
        .btn-icon { background: none; border: none; cursor: pointer; padding: 8px; }
        .container { max-width: 1200px; margin: 0 auto; padding: 16px; }
        
        .cats { display: flex; gap: 10px; overflow-x: auto; padding-bottom: 10px; }
        .chip { border: 1px solid #ddd; background: white; padding: 6px 14px; border-radius: 20px; cursor: pointer; white-space: nowrap; }
        .chip.active { background: var(--p); color: white; border-color: var(--p); }
        
        .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); gap: 16px; margin-top: 10px; }
        .card { background: white; border-radius: 12px; overflow: hidden; border: 1px solid #eee; }
        .card img { width: 100%; height: 140px; object-fit: cover; background: #eee; }
        .card-body { padding: 10px; }
        .price { font-weight: bold; color: var(--p); font-size: 16px; }
        .title { font-size: 14px; margin: 5px 0; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        
        .fab { position: fixed; bottom: 20px; right: 20px; width: 56px; height: 56px; background: #6200ea; color: white; border-radius: 16px; border: none; box-shadow: 0 4px 10px rgba(0,0,0,0.3); cursor: pointer; display: flex; align-items: center; justify-content: center; z-index: 200; }
        
        .modal { position: fixed; inset: 0; background: rgba(0,0,0,0.5); display: flex; align-items: center; justify-content: center; z-index: 300; }
        .dialog { background: white; width: 90%; max-width: 400px; padding: 20px; border-radius: 16px; }
        
        .toast { position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%); background: #333; color: white; padding: 10px 20px; border-radius: 20px; z-index: 400; }
    </style>
</head>
<body>
    <div id="app"></div>
    <script>
        // DATA
        const PRODUCTS = [
            { id: 1, title: 'Колбаса "Якутская"', price: 850, cat: 'meat', img: 'https://placehold.co/400x300/00639b/white?text=Meat' },
            { id: 2, title: 'Оленина с/к', price: 1200, cat: 'meat', img: 'https://placehold.co/400x300/00639b/white?text=Venison' },
            { id: 3, title: 'Жеребятина', price: 3500, cat: 'meat', img: 'https://placehold.co/400x300/00639b/white?text=Horse' },
            { id: 4, title: 'Кефир Туймаада', price: 120, cat: 'milk', img: 'https://placehold.co/400x300/00639b/white?text=Kefir' },
            { id: 5, title: 'Сливки 35%', price: 300, cat: 'milk', img: 'https://placehold.co/400x300/00639b/white?text=Cream' },
            { id: 6, title: 'Конфеты Ситэ', price: 600, cat: 'sweets', img: 'https://placehold.co/400x300/00639b/white?text=Candy' },
            { id: 7, title: 'Вафли Таежные', price: 150, cat: 'sweets', img: 'https://placehold.co/400x300/00639b/white?text=Waffles' },
            { id: 8, title: 'Унты Сардана', price: 25000, cat: 'clothes', img: 'https://placehold.co/400x300/00639b/white?text=Boots' },
            { id: 9, title: 'Чай Арктик', price: 350, cat: 'eco', img: 'https://placehold.co/400x300/00639b/white?text=Tea' }
        ];

        // STATE
        let state = { 
            page: 'home', 
            filter: 'all', 
            cart: JSON.parse(localStorage.getItem('cart')||'[]'), 
            user: JSON.parse(localStorage.getItem('user')||'null'),
            ai: false
        };

        // RENDER
        function render() {
            const app = document.getElementById('app');
            let content = '';

            if(state.page === 'home') {
                const list = state.filter === 'all' ? PRODUCTS : PRODUCTS.filter(p => p.cat === state.filter);
                content = `
                    <div class="container">
                        <div class="cats">
                            <button class="chip ${state.filter==='all'?'active':''}" onclick="setFilter('all')">Все</button>
                            <button class="chip ${state.filter==='meat'?'active':''}" onclick="setFilter('meat')">Мясо</button>
                            <button class="chip ${state.filter==='milk'?'active':''}" onclick="setFilter('milk')">Молоко</button>
                            <button class="chip ${state.filter==='sweets'?'active':''}" onclick="setFilter('sweets')">Сладости</button>
                            <button class="chip ${state.filter==='clothes'?'active':''}" onclick="setFilter('clothes')">Одежда</button>
                        </div>
                        <div class="grid">
                            ${list.map(p => `
                                <div class="card">
                                    <img src="${p.img}">
                                    <div class="card-body">
                                        <div class="title">${p.title}</div>
                                        <div class="price">${p.price} ₽</div>
                                        <button class="btn" style="width:100%; margin-top:5px" onclick="add(${p.id})">В корзину</button>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    </div>`;
            } else if (state.page === 'cart') {
                content = `<div class="container"><h1>Корзина (${state.cart.length})</h1>
                    ${state.cart.map(i => `<div>${i.title} - ${i.price}₽</div>`).join('')}
                    ${state.cart.length ? `<button class="btn" style="margin-top:20px; width:100%" onclick="checkout()">Заказать</button>` : 'Пусто'}
                </div>`;
            } else if (state.page === 'profile') {
                content = state.user ? 
                    `<div class="container"><h1>${state.user.name}</h1><p>${state.user.role}</p><button class="btn" style="background:red" onclick="logout()">Выйти</button></div>` :
                    `<div class="container"><h1>Вход</h1><button class="btn" onclick="login('buyer')">Я Покупатель</button> <button class="btn" onclick="login('seller')">Я Продавец</button></div>`;
            }

            app.innerHTML = `
                <div class="app-bar">
                    <div class="brand" onclick="nav('home')"><span class="material-icons-round">storefront</span> YakutiaMarket</div>
                    <div>
                        <button class="btn-icon" onclick="nav('profile')"><span class="material-icons-round">person</span></button>
                        <button class="btn-icon" onclick="nav('cart')"><span class="material-icons-round">shopping_bag</span> ${state.cart.length||''}</button>
                    </div>
                </div>
                ${content}
                <button class="fab" onclick="toggleAI()"><span class="material-icons-round">smart_toy</span></button>
                ${state.ai ? `
                    <div class="modal" onclick="toggleAI()">
                        <div class="dialog" onclick="event.stopPropagation()">
                            <h3>AI Помощник</h3>
                            <p>Привет! Я помогу с рецептами.</p>
                            <input placeholder="Спроси..." style="width:100%; padding:10px">
                        </div>
                    </div>` : ''}
            `;
        }

        // ACTIONS
        window.nav = (p) => { state.page = p; render(); }
        window.setFilter = (c) => { state.filter = c; render(); }
        window.add = (id) => { 
            state.cart.push(PRODUCTS.find(p => p.id === id)); 
            localStorage.setItem('cart', JSON.stringify(state.cart));
            toast('Добавлено'); render(); 
        }
        window.login = (r) => { 
            state.user = { name: r==='seller'?'Фермер':'Покупатель', role: r }; 
            localStorage.setItem('user', JSON.stringify(state.user));
            state.page = 'profile'; render(); 
        }
        window.logout = () => { state.user = null; localStorage.removeItem('user'); state.page='home'; render(); }
        window.toggleAI = () => { state.ai = !state.ai; render(); }
        window.checkout = () => { state.cart = []; localStorage.removeItem('cart'); alert('Заказ отправлен!'); render(); }
        
        function toast(msg) {
            const d = document.createElement('div'); d.className='toast'; d.innerText=msg;
            document.body.appendChild(d); setTimeout(()=>d.remove(), 1500);
        }

        // START
        render();
    </script>
</body>
</html>
