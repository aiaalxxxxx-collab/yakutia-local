<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>Yakutia Local — Маркетплейс</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: #f2f4f7;
      color: #111;
    }
    a { color: inherit; text-decoration: none; }
    img { max-width: 100%; display: block; }

    :root {
      --accent: #00a86b;
      --accent-dark: #008055;
    }

    header {
      background: var(--accent);
      color: #fff;
    }
    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 0 16px;
    }
    .header-top {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
      padding: 8px 0;
      flex-wrap: wrap;
    }
    .logo {
      font-weight: 700;
      font-size: 18px;
      letter-spacing: 0.08em;
      text-transform: uppercase;
    }
    .search {
      flex: 1 1 260px;
      display: flex;
      background: #fff;
      border-radius: 999px;
      padding: 4px 10px;
      gap: 6px;
    }
    .search input {
      flex: 1;
      border: none;
      outline: none;
      font: inherit;
      font-size: 13px;
    }
    .search button {
      border: none;
      background: var(--accent);
      color: #fff;
      border-radius: 999px;
      padding: 4px 10px;
      font-size: 12px;
      cursor: pointer;
    }
    .header-right {
      display: flex;
      gap: 10px;
      align-items: center;
      font-size: 13px;
    }
    .header-links {
      display: flex;
      gap: 10px;
    }
    .header-links a { color:#fff; }

    .lang-select {
      padding: 3px 6px;
      border-radius: 999px;
      border: none;
      font-size: 12px;
      cursor: pointer;
    }

    .tabs-bar {
      background: #ffffff;
      border-bottom: 1px solid #d0d4de;
    }
    .tabs-inner {
      display: flex;
      gap: 10px;
      padding: 8px 0;
      font-size: 14px;
    }
    .tab-btn {
      padding: 6px 10px;
      border-radius: 999px;
      cursor: pointer;
      border: 1px solid transparent;
    }
    .tab-btn.active {
      background: var(--accent);
      color: #fff;
      border-color: var(--accent);
    }

    main {
      max-width: 1200px;
      margin: 0 auto;
      padding: 16px;
    }

    .section-title {
      font-size: 18px;
      margin: 0 0 10px;
    }

    /* дополнительные фильтры: Акции / Популярное / По сезонам */
    .subfilters {
      display: flex;
      gap: 8px;
      margin-bottom: 10px;
      font-size: 13px;
      flex-wrap: wrap;
    }
    .subfilter-btn {
      padding: 4px 10px;
      border-radius: 999px;
      border: 1px solid #d0d4de;
      cursor: pointer;
      background: #fff;
    }
    .subfilter-btn.active {
      background: #e6f7ef;
      border-color: var(--accent);
      color: #055c36;
    }

    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      gap: 14px;
    }

    .card {
      background: #ffffff;
      border-radius: 12px;
      border: 1px solid #e0e0e0;
      padding: 10px;
      display: flex;
      flex-direction: column;
      font-size: 13px;
      position: relative;
      box-shadow: 0 4px 10px rgba(0,0,0,0.04);
    }
    .card-like {
      position: absolute;
      top: 8px;
      right: 8px;
      font-size: 16px;
      cursor: pointer;
      color: #999;
    }
    .badge-top {
      position: absolute;
      left: 8px;
      top: 8px;
      background: #ff9800;
      color: #fff;
      font-size: 11px;
      padding: 2px 6px;
      border-radius: 999px;
    }
    .badge-sale {
      position: absolute;
      left: 8px;
      top: 28px;
      background: #e91e63;
      color: #fff;
      font-size: 11px;
      padding: 2px 6px;
      border-radius: 999px;
    }
    .card-img {
      height: 180px;
      border-radius: 10px;
      background: #f5f5f5;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 12px;
      color: #666;
      margin-bottom: 8px;
      text-align: center;
      padding: 4px;
    }
    .card-price {
      margin-top: 4px;
      font-size: 16px;
      font-weight: 600;
      color: #e91e63;
    }
    .card-price-old {
      font-size: 11px;
      color: #999;
      text-decoration: line-through;
      margin-left: 6px;
    }
    .card-discount {
      font-size: 11px;
      color: #388e3c;
      margin-left: 4px;
    }
    .card-title {
      margin-top: 4px;
      font-size: 13px;
      line-height: 1.3;
    }
    .card-meta {
      margin-top: 4px;
      font-size: 11px;
      color: #777;
    }

    .card-ads {
      background: #ffffff;
      border-radius: 10px;
      border: 1px solid #e0e0e0;
      padding: 8px;
      font-size: 13px;
    }
    .ads-title { font-weight: 500; margin-bottom: 4px; }
    .ads-price { font-weight: 600; margin-bottom: 2px; }
    .ads-meta { font-size: 11px; color: #777; }

    .card-event {
      background: #ffffff;
      border-radius: 10px;
      border: 1px solid #e0e0e0;
      padding: 8px;
      font-size: 13px;
    }
    .event-date { font-size: 11px; color: #555; margin-bottom: 2px; }
    .event-title { font-weight: 600; margin-bottom: 2px; }
    .event-place { font-size: 11px; color: #777; }
  </style>
</head>
<body>

<header>
  <div class="container header-top">
    <div class="logo" data-i18n="logo">Якутия Локальная</div>
    <div class="search">
      <input type="text" data-i18n-placeholder="search_placeholder" placeholder="Искать товары, объявления, события…">
      <button type="button" data-i18n="btn_search">Найти</button>
    </div>
    <div class="header-right">
      <select class="lang-select" id="lang-select">
        <option value="ru">RU</option>
        <option value="en">EN</option>
        <option value="zh">中文</option>
      </select>
      <div class="header-links">
        <a href="cabinet.html" data-i18n="link_login">Войти</a>
        <span data-i18n="link_orders">Мои заказы</span>
        <span data-i18n="link_cart">Корзина</span>
      </div>
    </div>
  </div>
</header>

<div class="tabs-bar">
  <div class="container tabs-inner">
    <div class="tab-btn active" data-tab="market" data-i18n="tab_market">Маркетплейс</div>
    <div class="tab-btn" data-tab="ads" data-i18n="tab_ads">Объявления</div>
    <div class="tab-btn" data-tab="events" data-i18n="tab_events">Афиша</div>
  </div>
</div>

<main>
  <h1 class="section-title" id="section-title" data-i18n="title_market">Товары местных производителей</h1>

  <!-- Дополнительные фильтры -->
  <div class="subfilters" id="subfilters">
    <button class="subfilter-btn active" data-filter="all" data-i18n="filter_all">Все</button>
    <button class="subfilter-btn" data-filter="sale" data-i18n="filter_sales">Акции</button>
    <button class="subfilter-btn" data-filter="popular" data-i18n="filter_popular">Популярное</button>
    <button class="subfilter-btn" data-filter="season" data-i18n="filter_season">По сезонам</button>
  </div>

  <!-- Маркетплейс -->
  <div class="grid" id="tab-market"></div>

  <!-- Объявления -->
  <div class="grid" id="tab-ads" style="display:none;">
    <article class="card-ads">
      <div class="ads-title">Продам шкуры оленя</div>
      <div class="ads-price">12 000 ₽</div>
      <div class="ads-meta">Якутск • Частное объявление • Сегодня</div>
    </article>
    <article class="card-ads">
      <div class="ads-title">Сдам в аренду мастерскую</div>
      <div class="ads-price">25 000 ₽ / месяц</div>
      <div class="ads-meta">Центр • Для ремесленников и мастеров</div>
    </article>
  </div>

  <!-- Афиша -->
  <div class="grid" id="tab-events" style="display:none;">
    <article class="card-event">
      <div class="event-date">12 декабря, 19:00</div>
      <div class="event-title">Фестиваль локальных брендов «Сделано в Якутии»</div>
      <div class="event-place">ТРЦ • Билеты онлайн</div>
    </article>
    <article class="card-event">
      <div class="event-date">20 декабря, 18:30</div>
      <div class="event-title">Мастер‑класс по резьбе по кости</div>
      <div class="event-place">Дом ремёсел • Запись обязательна</div>
    </article>
  </div>
</main>

<script>
  // Переключение основных вкладок
  const tabs = document.querySelectorAll('.tab-btn');
  const blocks = {
    market: document.getElementById('tab-market'),
    ads: document.getElementById('tab-ads'),
    events: document.getElementById('tab-events')
  };
  const titleEl = document.getElementById('section-title');
  const subfilters = document.getElementById('subfilters');

  tabs.forEach(btn => {
    btn.addEventListener('click', () => {
      const tab = btn.dataset.tab;
      tabs.forEach(b => b.classList.remove('active'));
      btn.classList.add('active');
      Object.keys(blocks).forEach(key => {
        blocks[key].style.display = key === tab ? 'grid' : 'none';
      });
      if (tab === 'market') {
        titleEl.dataset.i18n = 'title_market';
      }
      if (tab === 'ads') {
        titleEl.dataset.i18n = 'title_ads';
      }
      if (tab === 'events') {
        titleEl.dataset.i18n = 'title_events';
      }
      applyTranslations();
      subfilters.style.display = tab === 'market' ? 'flex' : 'none';
    });
  });

  // Фильтры "Все / Акции / Популярное / По сезонам"
  let currentFilter = 'all';
  document.querySelectorAll('.subfilter-btn').forEach(btn => {
    btn.addEventListener('click', () => {
      currentFilter = btn.dataset.filter;
      document.querySelectorAll('.subfilter-btn').forEach(b => b.classList.remove('active'));
      btn.classList.add('active');
      renderProducts(); // перерисуем товары с фильтром
    });
  });

  // Загрузка товаров с сервера
  let productsCache = [];
  async function loadMarketFromServer() {
    try {
      const res = await fetch('/api/products');
      const products = await res.json();
      productsCache = products;
      renderProducts();
    } catch (e) {
      console.error(e);
    }
  }

  function renderProducts() {
    const container = document.getElementById('tab-market');
    container.innerHTML = '';

    let products = [...productsCache];

    // фильтрация
    if (currentFilter === 'sale') {
      products = products.filter(p => p.isSale);
    } else if (currentFilter === 'popular') {
      products = products
        .slice()
        .sort((a, b) => (b.popularity || 0) - (a.popularity || 0));
    } else if (currentFilter === 'season') {
      const month = new Date().getMonth(); // 0-11
      const season = (month === 11 || month <= 1) ? 'winter'
                    : (month >= 2 && month <= 4) ? 'spring'
                    : (month >= 5 && month <= 7) ? 'summer'
                    : 'autumn';
      products = products.filter(p => !p.season || p.season === season);
    }

    products
      .filter(p => p.type === 'market')
      .sort((a, b) => (b.promoted === true) - (a.promoted === true))
      .forEach(p => {
        const card = document.createElement('article');
        card.className = 'card';
        card.innerHTML = `
          ${p.promoted ? '<div class="badge-top">ТОП</div>' : ''}
          ${p.isSale ? '<div class="badge-sale">Акция</div>' : ''}
          <div class="card-like">♡</div>
          <div class="card-img">${p.desc || 'Фото товара'}</div>
          <div class="card-price">
            ${p.price} ₽
            ${p.oldPrice ? '<span class="card-price-old">'+p.oldPrice+' ₽</span>' : ''}
            ${p.discount ? '<span class="card-discount">'+p.discount+'%</span>' : ''}
          </div>
          <div class="card-title">${p.title}</div>
          <div class="card-meta">${p.place || 'Якутия'}</div>
        `;
        container.appendChild(card);
      });
  }

  document.addEventListener('DOMContentLoaded', () => {
    loadMarketFromServer();
    applyTranslations();
  });

  // Простейшая система переводов (RU / EN / ZH)
  const translations = {
    ru: {
      logo: 'Якутия Локальная',
      search_placeholder: 'Искать товары, объявления, события…',
      btn_search: 'Найти',
      link_login: 'Войти',
      link_orders: 'Мои заказы',
      link_cart: 'Корзина',
      tab_market: 'Маркетплейс',
      tab_ads: 'Объявления',
      tab_events: 'Афиша',
      title_market: 'Товары местных производителей',
      title_ads: 'Объявления жителей Якутии',
      title_events: 'События и афиша',
      filter_all: 'Все',
      filter_sales: 'Акции',
      filter_popular: 'Популярное',
      filter_season: 'По сезонам'
    },
    en: {
      logo: 'Yakutia Local',
      search_placeholder: 'Search products, listings, events…',
      btn_search: 'Search',
      link_login: 'Sign in',
      link_orders: 'My orders',
      link_cart: 'Cart',
      tab_market: 'Marketplace',
      tab_ads: 'Listings',
      tab_events: 'Events',
      title_market: 'Local products',
      title_ads: 'Listings from locals',
      title_events: 'Events & activities',
      filter_all: 'All',
      filter_sales: 'Deals',
      filter_popular: 'Popular',
      filter_season: 'Seasonal'
    },
    zh: {
      logo: '雅库茨克本地市集',
      search_placeholder: '搜索商品、公告、活动…',
      btn_search: '搜索',
      link_login: '登录',
      link_orders: '我的订单',
      link_cart: '购物车',
      tab_market: '市集',
      tab_ads: '公告',
      tab_events: '活动',
      title_market: '本地生产者的商品',
      title_ads: '当地居民的公告',
      title_events: '活动与演出',
      filter_all: '全部',
      filter_sales: '优惠',
      filter_popular: '热门',
      filter_season: '应季'
    }
  };

  const langSelect = document.getElementById('lang-select');
  let currentLang = 'ru';

  function applyTranslations() {
    const dict = translations[currentLang];
    if (!dict) return;

    document.querySelectorAll('[data-i18n]').forEach(el => {
      const key = el.dataset.i18n;
      if (dict[key]) el.textContent = dict[key];
    });

    document.querySelectorAll('[data-i18n-placeholder]').forEach(el => {
      const key = el.dataset.i18nPlaceholder;
      if (dict[key]) el.placeholder = dict[key];
    });
  }

  langSelect.addEventListener('change', () => {
    currentLang = langSelect.value;
    applyTranslations();
  });
</script>

</body>
</html>
   
